<!DOCTYPE html>
<html>

<head><meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width" />
<link
  rel="icon"
  href="/fav3.svg"
  type="image/gif"
/>


<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
  media="print"
  onload="this.media='all'"
/>
<noscript>
  <link
    href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet"
  />
</noscript>


<link
  rel="stylesheet"
  href="/css/font.css"
  media="all"
/>



<meta property="og:title" content="Accessing Amplify GraphQL API objects from Lambda functions" />
<meta property="og:description" content="Amplify offers the ability to add Lambda functions which use other configured resources including AppSync API DynamoDB Tables. This article focuses on creating a Lambda function with Amplify CLI that has access to these tables." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ziggy6792.github.io/blogs/amplify-lambda-dynamodb/" /><meta property="article:section" content="blogs" />
<meta property="article:published_time" content="2020-03-20T09:07:48+07:00" />
<meta property="article:modified_time" content="2020-03-20T09:07:48+07:00" /><meta property="og:site_name" content="Simon&#39;s Portfolio" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Accessing Amplify GraphQL API objects from Lambda functions"/>
<meta name="twitter:description" content="Amplify offers the ability to add Lambda functions which use other configured resources including AppSync API DynamoDB Tables. This article focuses on creating a Lambda function with Amplify CLI that has access to these tables."/>







  
  <link
    rel="stylesheet"
    href="/css/style.min.fdc82a94462a147e6b433dfc4f843ec36a7dcc6681131cdce17200f42d68c492.css"
    integrity="sha256-/cgqlEYqFH5rQz38T4Q+w2p9zGaBExzc4XIA9C1oxJI="
  />
<link
    rel="stylesheet"
    href="/bootstrap-5/css/bootstrap.min.css"
    media="all"
  /><link
  rel="stylesheet"
  href="/css/header.css"
  media="all"
/>
<link
  rel="stylesheet"
  href="/css/footer.css"
  media="all"
/>


<link
  rel="stylesheet"
  href="/css/theme.css"
  media="all"
/>




<style>
    :root {
        --text-color: #343a40;
        --text-secondary-color: #6c757d;
        --background-color: #eaedf0;
        --secondary-background-color: #64ffda1a;
        --primary-color: #007bff;
        --secondary-color: #f8f9fa;

         
        --text-color-dark: #e4e6eb;
        --text-secondary-color-dark: #b0b3b8;
        --background-color-dark: #18191a;
        --secondary-background-color-dark: #212529;
        --primary-color-dark: #ffffff;
        --secondary-color-dark: #212529;
    }
    body {
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        text-align: left;
    }

    html {
        background-color: var(--background-color) !important;
    }

    body::-webkit-scrollbar {
        width: .5em;
        height: .5em;
        background-color: var(--background-color);
    }

    ::-webkit-scrollbar-track {
        box-shadow: inset 0 0 6px var(--background-color);
        border-radius: 1rem;
    }

    ::-webkit-scrollbar-thumb {
        border-radius: 1rem;
        background-color: var(--secondary-color);
        outline: 1px solid var(--background-color);
    }

    #search-content::-webkit-scrollbar {
        width: .5em;
        height: .1em;
        background-color: var(--background-color);
    }
</style>

  <meta name="description" content="" />
  <link rel="stylesheet" href="/css/single.css" />

  
  <script
    defer
    src="/fontawesome-5/all-5.15.4.js"
  ></script>

  <title>Accessing Amplify GraphQL API objects from Lambda functions | Simon&#39;s Portfolio
  </title>
</head>

<body class="light">
  
  
<script>
    let localStorageValue = localStorage.getItem("pref-theme");
    let mediaQuery = window.matchMedia('(prefers-color-scheme: dark)').matches;

    switch (localStorageValue) {
        case "dark":
            document.body.classList.add('dark');
            break;
        case "light":
            document.body.classList.remove('dark');
            break;
        default:
            if (mediaQuery) {
                document.body.classList.add('dark');
            }
            break;
    }
</script>



<header>
    <nav class="pt-3 navbar navbar-expand-lg animate">
        <div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5">
            
            <a class="navbar-brand primary-font text-wrap" href="/">
                
                <img src="/fav3.svg" width="30" height="30"
                    class="d-inline-block align-top">
                Simon&#39;s Portfolio
                
            </a>

            
                <div>
                    <input id="search" autocomplete="off" class="form-control mr-sm-2 d-none d-md-block" placeholder='Ctrl &#43; k to Search...'
                        aria-label="Search" oninput="searchOnChange(event)">
                </div>
            

            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true">
                    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path>
                </svg>
            </button>

            
            <div class="collapse navbar-collapse text-wrap primary-font" id="navbarContent">
                <ul class="navbar-nav ms-auto text-center">
                    
                        <li class="nav-item navbar-text d-block d-md-none">
                            <div class="nav-link">
                                <input id="search" autocomplete="off" class="form-control mr-sm-2" placeholder='Ctrl &#43; k to Search...' aria-label="Search" oninput="searchOnChange(event)">
                            </div>
                        </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#about" aria-label="about">
                            About Me
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#experience"
                            aria-label="experience">
                            Experience
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#education"
                            aria-label="education">
                            Education
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#projects"
                            aria-label="projects">
                            Projects
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#achievements"
                            aria-label="achievements">
                            Recommendations
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#contact"
                            aria-label="contact">
                            Contact
                        </a>
                    </li>
                    

                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/blogs" title="Blog posts">
                            
                            Blog
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/gallery" title="Blog posts">
                            
                            Gallery
                        </a>
                    </li>
                    
                    

                    
                    <li class="nav-item navbar-text">
                        
                        <div class="text-center">
                            <button id="theme-toggle">
                                <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </button>
                        </div>
                    </li>
                    

                </ul>

            </div>
        </div>
    </nav>
</header>
<div id="content">
  <section id="single">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-sm-12 col-md-12 col-lg-9">
          <div class="pr-lg-4">
            <div class="title mb-5">
              <h1 class="text-center mb-4">Accessing Amplify GraphQL API objects from Lambda functions</h1>
              <div class="text-center">
                
                <small>|</small>
                Mar 20, 2020
                
                  <span id="readingTime">
                    min read
                  </span>
                
              </div>
            </div>
            
              <div class="featured-image">
                <img
                  class="img-fluid"
                  src="/images/posts/Accessing-DynamoDB-Tables/Amplify.png"
                  alt="Accessing Amplify GraphQL API objects from Lambda functions"
                />
              </div>
            


            <hr class="full-width" />
            
            <article class="page-content p-2"><h2 id="introduction">Introduction</h2>
<p>Amplify offers the ability to add Lambda functions which use other configured resources including API objects backed by DynamoDb. This article will focus on creating a lambda function with the Amplify CLI that has access to the DynamoDB tables setup for an <a href="https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js#create-the-graphql-api">AppSync GraphQL API</a>. <br>
Specifically we will look at;</p>
<ul>
<li>Creating a Lambda function with Amplify CLI configured to use DynamoDB table resources</li>
<li>The resource provisioning mechanism and potential problems with creating Lambdas created through Amplify</li>
<li>Writing &amp; testing a sample Lambda handler to demonstrate its capabilities</li>
</ul>
<p><strong>WHY?</strong></p>
<ul>
<li>Perhaps you want to write some custom graphQL <a href="https://docs.amplify.aws/cli/graphql-transformer/directives#function">@function</a> resolvers that interact with your API DynamoDB tables directly (e.g. add a batch of items to a table)</li>
<li>Or, set up triggers on your tables (e.g. to cascade deletes to orphaned items)</li>
</ul>
<h2 id="pre-requisites">Pre-requisites</h2>
<ul>
<li>Install Amplify CLI (version 4.16.1 or higher)</li>
<li>Run Amplify Init</li>
<li>Create GraphQL API</li>
</ul>
<h2 id="creating-a-lambda-function-with-amplify-cli">Creating a Lambda function with Amplify CLI</h2>
<p>Use the following commands to create a Lambda function with the Amplify CLI. After selecting the category <code>storage</code>, you will be prompted to select DynamoDB tables wich exist for the GraphQL API <a href="https://docs.amplify.aws/cli/graphql-transformer/directives#model">@model</a>.</p>
<p><strong>NOTE</strong>: You will need Amplify CLI version 4.16.1 or higher.</p>
<!-- <script type="application/javascript" src="https://gist.github.com/ziggy6792/f8ea26516f51fbb7bf2ee024f9d054f0.js?file=createLambdaFunction.txt"></script>
 -->
<pre tabindex="0"><code>NBMAC0056:SwtNinja verhoeven$ amplify add function
Using service: Lambda, provided by: awscloudformation
? Provide a friendly name for your resource to be used as a label for this category in the project: doSomethingToDBTables
? Provide the AWS Lambda function name: doSomethingToDBTables
? Choose the function runtime that you want to use: NodeJS
? Choose the function template that you want to use: Hello World
? Do you want to access other resources created in this project from your Lambda function? Yes
? Select the category storage
? Storage has 8 resources in this project. Select the one you would like your Lambda to access Event:@model(appsync), Competition:@model(appsync), Heat:@model(appsync), SeedSlot:@model(appsync), Ride
rAllocation:@model(appsync), User:@model(appsync)
? Select the operations you want to permit for Event:@model(appsync) create, read, update, delete
? Select the operations you want to permit for Competition:@model(appsync) create, read, update, delete
? Select the operations you want to permit for Heat:@model(appsync) create, read, update, delete
? Select the operations you want to permit for SeedSlot:@model(appsync) create, read, update, delete
? Select the operations you want to permit for RiderAllocation:@model(appsync) create, read, update, delete
? Select the operations you want to permit for User:@model(appsync) create, read, update, delete

You can access the following resource attributes as environment variables from your Lambda function
        API_COMPAPI_COMPETITIONTABLE_ARN
        API_COMPAPI_COMPETITIONTABLE_NAME
        API_COMPAPI_EVENTTABLE_ARN
        API_COMPAPI_EVENTTABLE_NAME
        API_COMPAPI_GRAPHQLAPIIDOUTPUT
        API_COMPAPI_HEATTABLE_ARN
        API_COMPAPI_HEATTABLE_NAME
        API_COMPAPI_RIDERALLOCATIONTABLE_ARN
        API_COMPAPI_RIDERALLOCATIONTABLE_NAME
        API_COMPAPI_SEEDSLOTTABLE_ARN
        API_COMPAPI_SEEDSLOTTABLE_NAME
        API_COMPAPI_USERTABLE_ARN
        API_COMPAPI_USERTABLE_NAME
        ENV
        REGION
? Do you want to invoke this function on a recurring schedule? No
? Do you want to edit the local lambda function now? Yes
Please edit the file in your editor: &lt;project-dir&gt;/amplify/backend/function/doSomethingToDBTables/src/index.js
? Press enter to continue
Successfully added resource doSomethingToDBTables locally.

Next steps:
Check out sample function code generated in &lt;project-dir&gt;/amplify/backend/function/doSomethingToDBTables/src
&#34;amplify function build&#34; builds all of your functions currently in the project
&#34;amplify mock function &lt;functionName&gt;&#34; runs your function locally
&#34;amplify push&#34; builds all of your local backend resources and provisions them in the cloud
&#34;amplify publish&#34; builds all of your local backend and front-end resources (if you added hosting category) and provisions them in the cloud

NBMAC0056:SwtNinja verhoeven$ amplify push
✔ Successfully pulled backend environment compapi from the cloud.

Current Environment: compapi

| Category | Resource name         | Operation | Provider plugin   |
| -------- | --------------------- | --------- | ----------------- |
| Function | doSomethingToDBTables | Create    | awscloudformation |
| Api      | compapi               | No Change | awscloudformation |
? Are you sure you want to continue? Yes
</code></pre><h2 id="potential-maximum-policy-size-issue-when-running-amplify-push">Potential maximum policy size issue when running amplify push</h2>
<p>When running amplify push at the end of the last step you may see the following <a href="https://github.com/aws-amplify/amplify-cli/issues/1699">issue</a>.</p>
<blockquote>
<p>&ldquo;Maximum policy size of 10240 bytes exceeded for role <code>&lt;apiName&gt;LambdaRole26741da9-&lt;apiName&gt;</code>&rdquo;</p>
</blockquote>
<p>This issue occurs when the policy created for the lambda role (the IAM role created to run your new lambda function) exceeds the maximum size allowed for role inline policies.</p>
<h3 id="option1-reducing-the-number-of-tables-added-to-the-role-policy">Option1: Reducing the number of tables added to the role policy</h3>
<p>If possible, you should reduce the tables and actions granted in the previous step (following the best practice that each lambda only has access to the actions and resources it expressly needs). However, this may not be possible. In my case, I wanted to write a lambda function that cascaded deletes through my table schema. Therefore, my lambda function needs to have access to all of my API tables.</p>
<h3 id="option2-customizing-local-cloudformation-template-generated-by-amplify">Option2: Customizing local CloudFormation template generated by Amplify</h3>
<p>To understand a work around for this issue, it is important to explain in more detail what <code>amplify add function</code> is actually doing. This method creates a local folder for the function containing a CloudFormation template. E.g;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">amplify</span><span style="color:#f92672">/</span><span style="color:#a6e22e">backend</span><span style="color:#f92672">/</span><span style="color:#a6e22e">function</span><span style="color:#f92672">/</span><span style="color:#a6e22e">doSomethingToDBTables</span><span style="color:#f92672">/</span><span style="color:#a6e22e">doSomethingToDBTables</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cloudformation</span><span style="color:#f92672">-</span><span style="color:#a6e22e">template</span>.<span style="color:#a6e22e">json</span></span></span></code></pre></div>
<p>This template describes the lambda to be created when amplify push is next run. However, Amplify is not very clever when it comes to creating the templates which create role inline policies. The Amplify created CloudFormation template creates a separate inline policy statement for each DynamoDB table (even if the allowed actions are the same).</p>
<p>For example; granting these actions;</p>
<ul>
<li><code>&quot;dynamodb:Put*&quot;</code></li>
<li><code>&quot;dynamodb:Create*&quot;</code></li>
<li><code>&quot;dynamodb:BatchWriteItem&quot;</code></li>
<li><code>&quot;dynamodb:Get*&quot;</code></li>
<li><code>&quot;dynamodb:BatchGetItem&quot;</code></li>
<li><code>&quot;dynamodb:List*&quot;</code></li>
<li><code>&quot;dynamodb:Describe*&quot;</code></li>
<li><code>&quot;dynamodb:Scan&quot;</code></li>
<li><code>&quot;dynamodb:Query&quot;</code></li>
<li><code>&quot;dynamodb:Update*&quot;</code></li>
<li><code>&quot;dynamodb:RestoreTable*&quot;</code></li>
<li><code>&quot;dynamodb:Delete*&quot;</code></li>
</ul>
<p>To these tables;</p>
<ul>
<li>Competition-xl3qodhqsfdmhe5psj4vqa7wsy-compapi</li>
<li>User-xl3qodhqsfdmhe5psj4vqa7wsy-compapi</li>
<li>Event-xl3qodhqsfdmhe5psj4vqa7wsy-compapi</li>
<li>Heat-xl3qodhqsfdmhe5psj4vqa7wsy-compapi</li>
<li>RiderAllocation-xl3qodhqsfdmhe5psj4vqa7wsy-compapi</li>
<li>SeedSlot-xl3qodhqsfdmhe5psj4vqa7wsy-compapi</li>
</ul>
<p>Will create the following access policy list of statements;</p>
<!-- <script type="application/javascript" src="https://gist.github.com/ziggy6792/f8ea26516f51fbb7bf2ee024f9d054f0.js?file=accessPolicyExample1.json"></script>
 -->
<pre tabindex="0"><code>{
  &#34;Version&#34;: &#34;2012-10-17&#34;,
  &#34;Statement&#34;: [
      {
          &#34;Action&#34;: [
              &#34;dynamodb:Put*&#34;,
              &#34;dynamodb:Create*&#34;,
              &#34;dynamodb:BatchWriteItem&#34;,
              &#34;dynamodb:Get*&#34;,
              &#34;dynamodb:BatchGetItem&#34;,
              &#34;dynamodb:List*&#34;,
              &#34;dynamodb:Describe*&#34;,
              &#34;dynamodb:Scan&#34;,
              &#34;dynamodb:Query&#34;,
              &#34;dynamodb:Update*&#34;,
              &#34;dynamodb:RestoreTable*&#34;,
              &#34;dynamodb:Delete*&#34;
          ],
          &#34;Resource&#34;: [
              &#34;arn:aws:dynamodb:ap-southeast-1:694710432912:table/Competition-xl3qodhqsfdmhe5psj4vqa7wsy-compapi&#34;,
              &#34;arn:aws:dynamodb:ap-southeast-1:694710432912:table/Competition-xl3qodhqsfdmhe5psj4vqa7wsy-compapi/index/*&#34;
          ],
          &#34;Effect&#34;: &#34;Allow&#34;
      },{
        &#34;Action&#34;: [
            &#34;dynamodb:Put*&#34;,
            &#34;dynamodb:Create*&#34;,
            &#34;dynamodb:BatchWriteItem&#34;,
            &#34;dynamodb:Get*&#34;,
            &#34;dynamodb:BatchGetItem&#34;,
            &#34;dynamodb:List*&#34;,
            &#34;dynamodb:Describe*&#34;,
            &#34;dynamodb:Scan&#34;,
            &#34;dynamodb:Query&#34;,
            &#34;dynamodb:Update*&#34;,
            &#34;dynamodb:RestoreTable*&#34;,
            &#34;dynamodb:Delete*&#34;
        ],
        &#34;Resource&#34;: [
            &#34;arn:aws:dynamodb:ap-southeast-1:694710432912:table/User-xl3qodhqsfdmhe5psj4vqa7wsy-compapi&#34;,
            &#34;arn:aws:dynamodb:ap-southeast-1:694710432912:table/User-xl3qodhqsfdmhe5psj4vqa7wsy-compapi/index/*&#34;
        ],
        &#34;Effect&#34;: &#34;Allow&#34;
    },
    ...Repeat For Each Table
  ]
}
</code></pre><p>Which is actually equivalent to the following single statement (using the pattern resource identifier: <code>*-xl3qodhqsfdmhe5psj4vqa7wsy-compapi</code> matching every table for <strong>this particular GraphQL API Environment</strong>);</p>
<!-- <script type="application/javascript" src="https://gist.github.com/ziggy6792/f8ea26516f51fbb7bf2ee024f9d054f0.js?file=accessPolicyExample2.json"></script>
 -->
<pre tabindex="0"><code>{
  &#34;Version&#34;: &#34;2012-10-17&#34;,
  &#34;Statement&#34;: [
      {
          &#34;Action&#34;: [
              &#34;dynamodb:Put*&#34;,
              &#34;dynamodb:Create*&#34;,
              &#34;dynamodb:BatchWriteItem&#34;,
              &#34;dynamodb:Get*&#34;,
              &#34;dynamodb:BatchGetItem&#34;,
              &#34;dynamodb:List*&#34;,
              &#34;dynamodb:Describe*&#34;,
              &#34;dynamodb:Scan&#34;,
              &#34;dynamodb:Query&#34;,
              &#34;dynamodb:Update*&#34;,
              &#34;dynamodb:RestoreTable*&#34;,
              &#34;dynamodb:Delete*&#34;
          ],
          &#34;Resource&#34;: [
              &#34;arn:aws:dynamodb:ap-southeast-1:694710432912:table/*-xl3qodhqsfdmhe5psj4vqa7wsy-compapi&#34;,
              &#34;arn:aws:dynamodb:ap-southeast-1:694710432912:table/*-xl3qodhqsfdmhe5psj4vqa7wsy-compapi/index/*&#34;
          ],
          &#34;Effect&#34;: &#34;Allow&#34;
      }
  ]
}
</code></pre><p>The difference with using the second example however is that; generating policies this way will not cause policies to grow in size with the number of API tables and therefore will not easily hit the maximum policy size and cause the maximum policy size issue.</p>
<p>Therefore, a workaround for the maximum policy size issue is to modify your CloudFormation template to consolidate the assignment of actions to tables. Exactly how to modify the CloudFormation template will depend on the specific access rights you want to grant to your lambda. A common example however would be if you wanted to grant the same access to all API tables for a particular environment as shown above.</p>
<h2 id="modify-cloudformation-template-to-give-access-to-all-amplify-api-tables">Modify CloudFormation template to give access to all Amplify API tables</h2>
<p>Using <a href="https://stedolan.github.io/jq">jq</a> we can first remove all but the first policy statement from the generated <code>doSomethingToDBTables-cloudformation-template.json</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>jq <span style="color:#e6db74">&#39;.Resources.AmplifyResourcesPolicy.Properties.PolicyDocument.Statement[0] as $stmt0 |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    .Resources.AmplifyResourcesPolicy.Properties.PolicyDocument.Statement = [$stmt0]&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> doSomethingToDBTables-cloudformation-template.json &gt;output.json</span></span></code></pre></div>
<p><strong>NOTE</strong>: <code>jq</code> currently does not support in-place editing of files</p>
<p>This will create a new file <code>output.json</code> in the same directory, manually edit this file replacing the tableName specific resource identifier with the pattern identifier (<code>*-&lt;ApiName&gt;-&lt;EnvName&gt;</code>). Here&rsquo;s a sample diff;</p>
<script type="application/javascript" src="https://gist.github.com/ziggy6792/f8ea26516f51fbb7bf2ee024f9d054f0.js?file=editCloudFormationTemplate.diff"></script>

<p>Next, replace original <code>doSomethingToDBTables-cloudformation-template.json</code> with <code>output.json</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>rm doSomethingToDBTables-cloudformation-template.json
</span></span><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>mv output.json doSomethingToDBTables-cloudformation-template.json</span></span></code></pre></div>
<p><a href="https://gist.github.com/ziggy6792/f8ea26516f51fbb7bf2ee024f9d054f0#file-dosomethingtodbtables-cloudformation-template-json">Here</a> is an example of my final CloudFormation template.</p>
<p>Finally, run <code>amplify push</code>.</p>
<p>Go to your ec2 console. You should see the following created lambda function;</p>
<figure><img src="/images/posts/Accessing-DynamoDB-Tables/Created-Function.png"/><figcaption>
            <h4>Created Lambda Function</h4>
        </figcaption>
</figure>

<p>Along with the following attached role and access policy.</p>
<figure><img src="/images/posts/Accessing-DynamoDB-Tables/Created-Role.png"/><figcaption>
            <h4>Created Role</h4>
        </figcaption>
</figure>

<h2 id="test-your-new-function-write-to-dynamodb-from-lambda-function">Test your new function. Write to DynamoDB from Lambda Function</h2>
<p>To test access to dynamoDB from your new Lambda function, copy the following code (from line 23) into your local lambda function index.js, replacing the hello world function that was created <a href="/posts/amplify-lambda-dynamodb/#creating-a-lambda-function-with-amplify-cli">here</a>.</p>
<!-- <script type="application/javascript" src="https://gist.github.com/ziggy6792/f8ea26516f51fbb7bf2ee024f9d054f0.js?file=lambda-function-index.js"></script>
 -->
<pre tabindex="0"><code>/* Amplify Params - DO NOT EDIT
	API_COMPAPI_BPOSTTABLE_ARN
	API_COMPAPI_BPOSTTABLE_NAME
	API_COMPAPI_COMPETITIONTABLE_ARN
	API_COMPAPI_COMPETITIONTABLE_NAME
	API_COMPAPI_CUSTOMERTABLE_ARN
	API_COMPAPI_CUSTOMERTABLE_NAME
	API_COMPAPI_EVENTTABLE_ARN
	API_COMPAPI_EVENTTABLE_NAME
	API_COMPAPI_GRAPHQLAPIIDOUTPUT
	API_COMPAPI_HEATTABLE_ARN
	API_COMPAPI_HEATTABLE_NAME
	API_COMPAPI_RIDERALLOCATIONTABLE_ARN
	API_COMPAPI_RIDERALLOCATIONTABLE_NAME
	API_COMPAPI_SEEDSLOTTABLE_ARN
	API_COMPAPI_SEEDSLOTTABLE_NAME
	API_COMPAPI_USERTABLE_ARN
	API_COMPAPI_USERTABLE_NAME
	ENV
	REGION
Amplify Params - DO NOT EDIT */

var AWS = require(&#39;aws-sdk&#39;);
var uuid = require(&#39;uuid&#39;);

AWS.config.update({ region: process.env.REGION });

var ddb = new AWS.DynamoDB({ apiVersion: &#39;2012-08-10&#39; });

exports.handler = async (event, context, callback) =&gt; {
	let items = [{id:uuid.v4(),name:&#34;Hello World&#34;}];
	try {
		await write(process.env.API_COMPAPI_EVENTTABLE_NAME,items)
	} catch (err) {
		callback(err)
	}
	return callback(null,items);
};

async function write(tableName, items) {
	var itemsToWrite = items
	var params = {
		RequestItems: {
			[tableName]:
				itemsToWrite.map((item) =&gt; {
					return ({
						PutRequest: {
							Item: AWS.DynamoDB.Converter.marshall(item)
						}
					})
				})
		}

	};
	const data = await ddb.batchWriteItem(params).promise();
}
</code></pre><p><strong>IMPORTANT</strong>:</p>
<ul>
<li>Do not replace/edit the Amplify auto generated variables (lines 1 to 21), keep your own variables separate from this auto-generated code to ensure they are not overwritten.</li>
<li>Replace tableName (line 33) with one of your own resource attributes as environment variables that was created <a href="/posts/amplify-lambda-dynamodb/#creating-a-lambda-function-with-amplify-cli">here</a></li>
<li>You will also need to cd to you local lambda function directory and install npm package uuid locally</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>cd <span style="color:#e6db74">&#34;amplify/backend/function/doSomethingToDBTables/src/&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>npm i --save uuid</span></span></code></pre></div>
<p>Next run <code>amplify push</code></p>
<p>Now you can test your function in the AWS console;</p>
<figure><img src="/images/posts/Accessing-DynamoDB-Tables/Test-Function.png"/><figcaption>
            <h4>Test Function</h4>
        </figcaption>
</figure>

<p>And then verify that an item was created in the specified table;</p>
<figure><img src="/images/posts/Accessing-DynamoDB-Tables/Test-Function-Created-Item.png"/><figcaption>
            <h4>Test Function Success - Created Item</h4>
        </figcaption>
</figure>

<!-- <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;doSomethingToDBTables&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>  <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;2.0.0&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Lambda function generated by Amplify&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>  <span style="color:#f92672">&#34;main&#34;</span>: <span style="color:#e6db74">&#34;index.js&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>  <span style="color:#f92672">&#34;license&#34;</span>: <span style="color:#e6db74">&#34;Apache-2.0&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>  <span style="color:#f92672">&#34;dependencies&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    <span style="color:#f92672">&#34;lodash&#34;</span>: <span style="color:#e6db74">&#34;latest&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>  }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>}</span></span></code></pre></div> -->
</article>
          </div>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-3">
          <div class="sticky-sidebar">
            
              <aside class="toc">
                <h5>
                  Table Of Contents
                </h5>
                <div class="toc-content"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#pre-requisites">Pre-requisites</a></li>
    <li><a href="#creating-a-lambda-function-with-amplify-cli">Creating a Lambda function with Amplify CLI</a></li>
    <li><a href="#potential-maximum-policy-size-issue-when-running-amplify-push">Potential maximum policy size issue when running amplify push</a>
      <ul>
        <li><a href="#option1-reducing-the-number-of-tables-added-to-the-role-policy">Option1: Reducing the number of tables added to the role policy</a></li>
        <li><a href="#option2-customizing-local-cloudformation-template-generated-by-amplify">Option2: Customizing local CloudFormation template generated by Amplify</a></li>
      </ul>
    </li>
    <li><a href="#modify-cloudformation-template-to-give-access-to-all-amplify-api-tables">Modify CloudFormation template to give access to all Amplify API tables</a></li>
    <li><a href="#test-your-new-function-write-to-dynamodb-from-lambda-function">Test your new function. Write to DynamoDB from Lambda Function</a></li>
  </ul>
</nav></div>
              </aside>
            
            
              <aside class="tags">
                <h5>Tags</h5>
                <ul class="tags-ul list-unstyled list-inline">
                  
                    <li class="list-inline-item">
                      <a
                        href="https://ziggy6792.github.io/tags/aws"
                        target="_blank"
                        >AWS</a
                      >
                    </li>
                  
                    <li class="list-inline-item">
                      <a
                        href="https://ziggy6792.github.io/tags/amplify"
                        target="_blank"
                        >Amplify</a
                      >
                    </li>
                  
                    <li class="list-inline-item">
                      <a
                        href="https://ziggy6792.github.io/tags/appsync"
                        target="_blank"
                        >AppSync</a
                      >
                    </li>
                  
                    <li class="list-inline-item">
                      <a
                        href="https://ziggy6792.github.io/tags/dynamodb"
                        target="_blank"
                        >DynamoDB</a
                      >
                    </li>
                  
                    <li class="list-inline-item">
                      <a
                        href="https://ziggy6792.github.io/tags/lambda"
                        target="_blank"
                        >Lambda</a
                      >
                    </li>
                  
                    <li class="list-inline-item">
                      <a
                        href="https://ziggy6792.github.io/tags/cloudformation"
                        target="_blank"
                        >CloudFormation</a
                      >
                    </li>
                  
                </ul>
              </aside>
            
            
              <aside class="social">
                <h5>Social</h5>
                <div class="social-content">
                  <ul class="list-inline">
                    <li class="list-inline-item text-center">
                      <a
                        target="_blank"
                        href="https://twitter.com/share?text=Accessing%20Amplify%20GraphQL%20API%20objects%20from%20Lambda%20functions&url=https%3a%2f%2fziggy6792.github.io%2fblogs%2famplify-lambda-dynamodb%2f"
                      >
                        <i class="fab fa-twitter"></i>
                      </a>
                    </li>
                    <li class="list-inline-item text-center">
                      <a
                        target="_blank"
                        href="https://api.whatsapp.com/send?text=Accessing%20Amplify%20GraphQL%20API%20objects%20from%20Lambda%20functions: https%3a%2f%2fziggy6792.github.io%2fblogs%2famplify-lambda-dynamodb%2f"
                      >
                        <i class="fab fa-whatsapp"></i>
                      </a>
                    </li>
                    <li class="list-inline-item text-center">
                      <a
                        target="_blank"
                        href="mailto:?subject=Accessing%20Amplify%20GraphQL%20API%20objects%20from%20Lambda%20functions&amp;body=Check%20out%20this%20site https%3a%2f%2fziggy6792.github.io%2fblogs%2famplify-lambda-dynamodb%2f"
                      >
                        <i class="fa fa-envelope"></i>
                      </a>
                    </li>
                  </ul>
                </div>
              </aside>
            
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-9 p-4">
          
        </div>
      </div>
    </div>
    <button class="p-2 px-3" onclick="topFunction()" id="topScroll">
      <i class="fas fa-angle-up"></i>
    </button>
  </section>

  
    <div class="progress">
      <div
        id="scroll-progress-bar"
        class="progress-bar"
        role="progressbar"
        aria-valuenow="0"
        aria-valuemin="0"
        aria-valuemax="100"
      ></div>
    </div>
    <script src="/js/scrollProgressBar.js"></script>
  


  <script>
    var topScroll = document.getElementById("topScroll");
    window.onscroll = function () {
      scrollFunction();
    };

    function scrollFunction() {
      if (
        document.body.scrollTop > 20 ||
        document.documentElement.scrollTop > 20
      ) {
        topScroll.style.display = "block";
      } else {
        topScroll.style.display = "none";
      }
    }

    function topFunction() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
  </script>

  
    <script src="/js/readingTime.js"></script>
  

  </div><footer>
    <div class="container py-3" id="recent-posts">
    
    
    
    
    <div class="h3 text-center text-secondary py-3">
        Recent Posts
    </div>
    <div class="row justify-content-center">
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/blogs/amplify-lambda-dynamodb/">
                        <img src="/images/posts/Accessing-DynamoDB-Tables/Amplify.png" class="card-img-top" alt="Accessing Amplify GraphQL API objects from Lambda functions">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/blogs/amplify-lambda-dynamodb/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="Accessing Amplify GraphQL API objects from Lambda functions">Accessing Amplify GraphQL …</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p>Amplify offers the ability to add Lambda functions which use other configured resources including AppSync API DynamoDB Tables. This article focuses on creating a Lambda function with Amplify CLI that has access to these tables.</p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">Mar 20, 2020</span>
                    <a href="/blogs/amplify-lambda-dynamodb/" class="float-end btn btn-outline-info btn-sm">Read</a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/blogs/wakeboard-competition-app/">
                        <img src="/images/posts/wakeboard-competition-app/wakeboard-bw.jpg" class="card-img-top" alt="Wakeboard Competition App Project">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/blogs/wakeboard-competition-app/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="Wakeboard Competition App Project">Wakeboard Competition App …</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p>A short write up the Wakeboard Competition Management App; motivation, requirements, tools and design.</p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">Mar 19, 2020</span>
                    <a href="/blogs/wakeboard-competition-app/" class="float-end btn btn-outline-info btn-sm">Read</a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/blogs/wellcome-to-my-blog/">
                        <img src="/images/wellcome-to-my-blog/wellcome.jpg" class="card-img-top" alt="Welcome to my blog">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/blogs/wellcome-to-my-blog/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="Welcome to my blog">Welcome to my blog</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p>Introduction In this blog I aspire to detail my journey in adopting AWS Serverless Architecture;
Amplify Lambda Cognito AppSync DynamoDB API Gateway I am creating a Competition Management App for event organizers and competitors at Singapore Wakepark. This is a full stack serverless web application …</p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">Mar 15, 2020</span>
                    <a href="/blogs/wellcome-to-my-blog/" class="float-end btn btn-outline-info btn-sm">Read</a>
                </div>
            </div>
        </div>
        
    </div>
    
</div><div class="text-center pt-2">
    
    <span class="px-1">
        <a href="https://github.com/" aria-label="github">
            <svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792">
                <path
                    d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5t-203.5 84.5h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-86-13.5q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5h-224q-119 0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5 84.5t84.5 203.5z" />

                <metadata>
                    <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                        xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:dc="http://purl.org/dc/elements/1.1/">
                        <rdf:Description about="https://iconscout.com/legal#licenses"
                            dc:title="Github, Online, Project, Hosting, Square"
                            dc:description="Github, Online, Project, Hosting, Square" dc:publisher="Iconscout"
                            dc:date="2016-12-14" dc:format="image/svg+xml" dc:language="en">
                            <dc:creator>
                                <rdf:Bag>
                                    <rdf:li>Font Awesome</rdf:li>
                                </rdf:Bag>
                            </dc:creator>
                        </rdf:Description>
                    </rdf:RDF>
                </metadata>
            </svg>
        </a>
    </span>
    

    
    <span class="px-1">
        <a href="https://www.linkedin.com/in/simonverhoeven067/" aria-label="linkedin">
            <svg xmlns="http://www.w3.org/2000/svg" width='2.4em' height='2.4em' fill="#fff" aria-label="LinkedIn"
                viewBox="0 0 512 512">
                <rect width="512" height="512" fill="#0077b5" rx="15%" />
                <circle cx="142" cy="138" r="37" />
                <path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198" />
                <path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32" />
            </svg>
        </a>
    </span>
    

    

    

    
</div><div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-4 text-center">
      <div class="pb-2">
        <a href="https://ziggy6792.github.io/" title="Simon&#39;s Portfolio">
          <img alt="Footer logo" src="/fav3.svg" height="40px" width="40px" />
        </a>
      </div>
      &copy; 2023  All rights reserved
    </div>
  </div>
</div>
</footer><script src="/bootstrap-5/js/bootstrap.bundle.min.js"></script>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

</script>


    <script src="/js/search.js"></script>








  <section id="search-content" class="py-2">
    <div class="container" id="search-results"></div>
  </section>
</body>

</html>